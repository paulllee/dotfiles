#!/usr/bin/env bash

# [e]ditor [f]ile [f]inder
# works in both neovim and helix

set -e

if [ "$#" -eq 0 ]; then 
  printf "$(basename "$0"): No flags provided. Please review usage via '$(basename "$0") -h'.\n"
  exit 1
fi

FUNCTIONS="$HOME/.zsh/functions.zsh"

function zja() {  # [z]elli[j] [a]ctions
  zellij action move-focus up
  zellij action write-chars ":open ${1:-}"
  zellij action write 13
}

function ff() {  #[f]ilenames [f]zf
  zja "$(fd --hidden --type f | 
    fzf --preview "source $FUNCTIONS; bat {1}" )"
}

function rf() {  # [r]ipgrep [f]zf
  zja "$(rg --line-number --smart-case --hidden --glob="!.git" . | 
    fzf --delimiter=: --preview "source $FUNCTIONS; bcp {1} {2}" |
    cut -d ":" -f 1,2)"
}

USAGE_MESSAGE=$(
cat <<- END
An editor file finder using fzf to search through filenames or ripgrep

Supports ONE option at a time. It will choose the first option if multiple are provided
  $(basename "$0") -fr  Only run on filnames
  $(basename "$0") -rf  Only run on ripgrep

Usage:
  $(basename "$0") [option]

Options:
  -h  Print this help message
  -f  Filenames
  -r  Ripgrep
END
)

while getopts "hfr" FLAG
do
  case "${FLAG}" in
    h) printf "$USAGE_MESSAGE\n" && exit 0 ;;
    f) ff && exit 0 ;;
    r) rf && exit 0 ;;
  esac
done
